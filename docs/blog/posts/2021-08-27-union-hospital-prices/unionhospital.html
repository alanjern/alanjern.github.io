<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alan Jern">
<meta name="dcterms.date" content="2021-08-27">
<meta name="description" content="Due to a new federal law, hospitals must publish their price lists. The price list for Union Hospital in Terre Haute shows what many other price lists from hospitals around the country do – that insurers’ negotiated prices sometimes don’t make sense.">

<title>Alan Jern - Can you save money at Union Hospital by not using insurance?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../icon.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-71M9JBSY79"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-71M9JBSY79', { 'anonymize_ip': true});
</script>
<style>figure { padding: 0 2em 0 2em; }</style>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="Alan Jern - Can you save money at Union Hospital by not using insurance?">
<meta property="og:description" content="Due to a new federal law, hospitals must publish their price lists. The price list for Union Hospital in Terre Haute shows what many other price lists from hospitals around the country do – that insurers’ negotiated prices sometimes don’t make sense.">
<meta property="og:image" content="featured.jpg">
<meta property="og:site-name" content="Alan Jern">
<meta name="twitter:title" content="Alan Jern - Can you save money at Union Hospital by not using insurance?">
<meta name="twitter:description" content="Due to a new federal law, hospitals must publish their price lists. The price list for Union Hospital in Terre Haute shows what many other price lists from hospitals around the country do – that insurers’ negotiated prices sometimes don’t make sense.">
<meta name="twitter:image" content="featured.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Alan Jern</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../publications/publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../teaching/teaching.html" rel="" target="">
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../lab/lab.html" rel="" target="">
 <span class="menu-text">Lab</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Can you save money at Union Hospital by not using insurance?</h1>
<p class="subtitle lead">Depending on your insurance plan, maybe yes, for some procedures.</p>
  <div class="quarto-categories">
    <div class="quarto-category">Data Analysis</div>
  </div>
  </div>

<div>
  <div class="description">
    Due to a new federal law, hospitals must publish their price lists. The price list for Union Hospital in Terre Haute shows what many other price lists from hospitals around the country do – that insurers’ negotiated prices sometimes don’t make sense.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alan Jern </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 27, 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="featured.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Image credit: <a href="https://unsplash.com/@marceloleal80?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"><strong>Marcelo Leal</strong></a> on <a href="https://unsplash.com/@marceloleal80?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"><strong>Unsplash</strong></a>.</figcaption>
</figure>
</div>
<p>One of the many frustrating things about health care in the US is not having a clue what things are going to cost. But this year, a new federal law went into effect requiring hospitals to publish all of their prices.</p>
<p>I learned about this after reading <a href="https://www.nytimes.com/interactive/2021/08/22/upshot/hospital-prices.html">this article in the New York Times</a> by Sarah Kliff and Josh Katz. They analyzed the price lists at a number of hospitals and found some huge disparities in prices for identical treatments at the same hospitals and some puzzling discrepancies in insurers’ negotiated prices. Notably, sometimes, the listed price for a treatment negotiated by an insurance company was <em>higher</em> than the listed price for a patient with no insurance at all. For insurance plans with high deductibles, this means you could potentially save money by <em>not</em> using your insurance for some treatments.</p>
<p>This got me curious about my own insurance and my own local hospital, so I decided to do a similar analysis.</p>
<section id="the-data" class="level1">
<h1>The data 🗒</h1>
<p>Union Hospital, the largest health care provider in my town, makes their price list available <a href="https://www.myunionhealth.org/patients-and-visitors/for-patients/billing-and-insurance/online-estimate/">here</a>. It includes a line for each treatment or procedure for each different insurer. It’s admittedly a little hard to make sense of. Here’s a small sample of the data.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 36%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Code</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Gross charge</th>
<th style="text-align: left;">Max negotiated charge</th>
<th style="text-align: left;">Min negotiated charge</th>
<th style="text-align: left;">Insurer</th>
<th style="text-align: right;">Charge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">110.2</td>
<td style="text-align: left;">ear, nose, mouth, throat, cranial/facial malignancies</td>
<td style="text-align: left;">37,706.14</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">Caresource HIP</td>
<td style="text-align: right;">5687.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">110.2</td>
<td style="text-align: left;">ear, nose, mouth, throat, cranial/facial malignancies</td>
<td style="text-align: left;">37,706.14</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">Healthy Ind MD Wise</td>
<td style="text-align: right;">5687.37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">110.2</td>
<td style="text-align: left;">ear, nose, mouth, throat, cranial/facial malignancies</td>
<td style="text-align: left;">37,706.14</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">Healthy Indiana Anthem</td>
<td style="text-align: right;">5687.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">110.2</td>
<td style="text-align: left;">ear, nose, mouth, throat, cranial/facial malignancies</td>
<td style="text-align: left;">37,706.14</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">5,687.37</td>
<td style="text-align: left;">MHS HIP</td>
<td style="text-align: right;">5687.37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">110.4</td>
<td style="text-align: left;">ear, nose, mouth, throat, cranial/facial malignancies</td>
<td style="text-align: left;">50,000.16</td>
<td style="text-align: left;">13,963.29</td>
<td style="text-align: left;">13,963.29</td>
<td style="text-align: left;">Caresource HIP</td>
<td style="text-align: right;">13963.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">110.4</td>
<td style="text-align: left;">ear, nose, mouth, throat, cranial/facial malignancies</td>
<td style="text-align: left;">50,000.16</td>
<td style="text-align: left;">13,963.29</td>
<td style="text-align: left;">13,963.29</td>
<td style="text-align: left;">Healthy Ind MD Wise</td>
<td style="text-align: right;">13963.29</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>My interpretation of this is that the final column, <code>Charge</code>, is the result of the negotiation process and is what should be considered the final negotiated “price” of a procedure. The rest of my analysis is based on that assumption.</p>
</section>
<section id="does-my-own-insurance-plan-save-me-money" class="level1">
<h1>Does my own insurance plan save me money? 💵</h1>
<p>My insurance plan is <strong>Anthem Blue Access PPO</strong>. It’s part of the Blue Cross Blue Shield association, one of the biggest health insurance companies in the country. Like many people in the US, I get it through my employer and don’t really have much of a choice in the matter.</p>
<p>I was first interested in whether Anthem’s negotiated prices at Union were at least as good as those charged to people with no insurance. As Matt Eyles, chief executive of America’s Health Insurance Plans says in the NYT article, “Insurers want to make sure they are negotiating the best deals they can for their members, to make sure their products have competitive premiums”.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unionhospital_files/figure-html/plot-anthem-vs-self-pay-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot includes every treatment and procedure in Union’s price list (except for some extremely expensive ones). Each point is one procedure. Points that fall below the white diagonal line are actually cheaper with no insurance than with my Anthem insurance. Because there are so many points bunched up near the diagonal, it’s hard to tell that actually 91% of the points are on or above the line, suggesting that Anthem’s negotiated prices are generally good, relative to having no insurance (they are, unsurprisingly, much higher than Medicare’s prices).</p>
<p>But what are those remaining 9% of procedures? Imaging seems to account for a few. <strong>Union Hospital charges Anthem about $350 more for MRIs than it does for patients with no insurance.</strong> And it charges about <strong>$310 more for CT scans.</strong></p>
<p>For some other procedures, prices vary depending on several factors, and sometimes Anthem’s price is lower, and sometimes it isn’t. For example, here are all the prices for colonoscopies in the price list.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 82%">
<col style="width: 7%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Description</th>
<th style="text-align: right;">Anthem price</th>
<th style="text-align: right;">No insurance price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Colonoscopy through stoma; with removal of tumor(s), polyp(s), or other lesion(s) by hot biopsy forceps</td>
<td style="text-align: right;">2688.12</td>
<td style="text-align: right;">1881.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colonoscopy, flexible; with removal of foreign body(s)</td>
<td style="text-align: right;">2593.67</td>
<td style="text-align: right;">1815.57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colonoscopy, flexible; with control of bleeding, any method</td>
<td style="text-align: right;">2526.29</td>
<td style="text-align: right;">1768.41</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colonoscopy, flexible; with transendoscopic balloon dilation</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">2102.55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colonoscopy, flexible; with ablation of tumor(s), polyp(s), or other lesion(s) (includes pre- and post-dilation and guide wire passage, when performed)</td>
<td style="text-align: right;">2071.23</td>
<td style="text-align: right;">1449.86</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colonoscopy through stoma; with removal of tumor(s), polyp(s), or other lesion(s) by snare technique</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">2184.82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colonoscopy, flexible; with directed submucosal injection(s), any substance</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">2685.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colonoscopy, flexible; with band ligation(s) (eg, hemorrhoids)</td>
<td style="text-align: right;">3044.17</td>
<td style="text-align: right;">3466.60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colonoscopy, flexible; diagnostic, including collection of specimen(s) by brushing or washing, when performed (separate procedure)</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">3631.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colonoscopy, flexible; with removal of tumor(s), polyp(s), or other lesion(s) by hot biopsy forceps</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">3642.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colonoscopy, flexible; with biopsy, single or multiple</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">3705.97</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colonoscopy, flexible; with removal of tumor(s), polyp(s), or other lesion(s) by snare technique</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">3705.97</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Colonoscopy through stoma; diagnostic, including collection of specimen(s) by brushing or washing, when performed (separate procedure)</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">3726.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colonoscopy through stoma; with biopsy, single or multiple</td>
<td style="text-align: right;">2785.00</td>
<td style="text-align: right;">3758.64</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There doesn’t seem to be much rhyme or reason to when the Anthem prices are lower and when the cash (no insurance) prices are lower, but maybe I’m missing something. (There are some similar oddities in the pricing for C-sections.)</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unionhospital_files/figure-html/compare-prices-for-key-procedures-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="how-do-union-hospitals-negotiated-prices-compare-overall" class="level1">
<h1>How do Union Hospital’s negotiated prices compare overall? 📈</h1>
<p>The price list includes prices for nearly 150 different insurance plans. How do the rest of them fare? The plot below replicates the first plot but includes prices from all insurers. I’ve separated out the five largest private insurers – Aetna, Cigna, Humana, United, and the Blue Cross Blue Shield Association.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unionhospital_files/figure-html/compare-all-insurers-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Across all procedures, insurers’ negotiated prices don’t compare very favorably with Union Hospital’s cash prices for people with no insurance. The fact that “non-major” insurers’ prices beat the cash prices only 34% of the time is especially surprising because that group includes several Medicare plans, whose prices are consistently very low (and almost certainly beat the cash prices every time).</p>
</section>
<section id="what-does-this-mean" class="level1">
<h1>What does this mean? 🤨</h1>
<p>Information like this is potentially important for patients to have. But as the NYT article indicates, price discrepancies and inconsistencies are probably more embarrassing for the insurance companies than for the hospitals because the insurers want to be able to claim that they have negotiated competitive prices.</p>
<section id="how-seriously-should-we-take-this-information" class="level2">
<h2 class="anchored" data-anchor-id="how-seriously-should-we-take-this-information">How seriously should we take this information?</h2>
<p>It’s probably hard to be sure. The price that gets charged for medical care surely depends on lots of factors. So I personally wouldn’t consider it a guarantee that because an entry in this list shows that a specific procedure is cheaper with no insurance that I’d be better off not using my insurance to get it.</p>
<p>But this information isn’t made up either. Hospitals <em>do</em> use these price lists as a starting point (at least) for billing. So I think it’s reasonable to use these price lists to draw some broadly valid conclusions about the value of your health insurance and the approximate costs of your health care.</p>
</section>
<section id="how-much-does-this-matter" class="level2">
<h2 class="anchored" data-anchor-id="how-much-does-this-matter">How much does this matter?</h2>
<p>One last point I haven’t addressed is that the price charged by the hospital is not the same thing as the price you owe as an individual. The difference between a price tag of $50,000 and $60,000 may be irrelevant to you if you have health insurance with a deductible of $2,000 that pays all costs after that deductible is met. So some of these price discrepancies are problems for insurance companies, not for consumers.</p>
<p>But, as you’ll note above, some of the cases where Anthem is beat by the “no insurance” rates are well below common deductibles. So these cost differences can affect how much you are paying 💵.</p>
<section id="code-and-data" class="level3">
<h3 class="anchored" data-anchor-id="code-and-data">Code and data 📑</h3>
<p>Code and data for this analysis is available <a href="https://github.com/alanjern/union-hospital-prices">here</a>.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>